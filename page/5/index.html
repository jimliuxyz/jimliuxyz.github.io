<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-tw">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="S7HvkrH4R_HiKK7j675QXHEjbdWWQiVyrmMeDjXxZT8" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="自用筆記">
<meta property="og:type" content="website">
<meta property="og:title" content="自用筆記">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="自用筆記">
<meta property="og:description" content="自用筆記">
<meta property="og:locale" content="zh-tw">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自用筆記">
<meta name="twitter:description" content="自用筆記">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>自用筆記</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">自用筆記</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">自用筆記</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            檢索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/Room.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/Room.html" itemprop="url">Room</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:31:06+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TypeConverter"><a href="#TypeConverter" class="headerlink" title="TypeConverter"></a>TypeConverter</h2><blockquote>
<p>建立物件與database primitive type的轉換</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span></span>(</span><br><span class="line">        <span class="meta">@SerializedName(<span class="meta-string">"naText"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> naText: String,</span><br><span class="line">        <span class="meta">@SerializedName(<span class="meta-string">"taText"</span>)</span></span><br><span class="line">        <span class="keyword">var</span> taText: String</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//透過TypeConverter建立object與json字串的轉換</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordConverter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TypeConverter</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">word2Json</span><span class="params">(words: <span class="type">ArrayList</span>&lt;<span class="type">Word</span>&gt;)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">val</span> json = Gson().toJson(words)</span><br><span class="line">        <span class="keyword">return</span> json</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TypeConverter</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">json2Word</span><span class="params">(json: <span class="type">String</span>)</span></span>: ArrayList&lt;Word&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> turnsType = <span class="keyword">object</span> : TypeToken&lt;ArrayList&lt;Word&gt;&gt;() &#123;&#125;.type</span><br><span class="line">        <span class="keyword">val</span> list = Gson().fromJson&lt;ArrayList&lt;Word&gt;&gt;(json, turnsType)</span><br><span class="line">        <span class="keyword">return</span> list</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity(foreignKeys = [ForeignKey(entity = BookInfo::class,</span></span><br><span class="line"><span class="meta">        parentColumns = [<span class="meta-string">"id"</span>],</span></span><br><span class="line"><span class="meta">        childColumns = [<span class="meta-string">"bookId"</span>],</span></span><br><span class="line"><span class="meta">        onDelete = CASCADE)</span>])</span><br><span class="line"><span class="meta">@TypeConverters(WordConverter::class)</span> <span class="comment">//加入需要的TypeConverter</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">BookContent</span></span>(<span class="meta">@PrimaryKey(autoGenerate = true)</span> <span class="keyword">var</span> id: <span class="built_in">Long</span>,</span><br><span class="line">                       <span class="keyword">var</span> bookId: <span class="built_in">Long</span>,</span><br><span class="line">                       <span class="keyword">var</span> words: ArrayList&lt;Word&gt; = ArrayList&lt;Word&gt;()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="ForeignKey-外鍵"><a href="#ForeignKey-外鍵" class="headerlink" title="ForeignKey (外鍵)"></a>ForeignKey (外鍵)</h2><blockquote>
<p>使該table(child)與外界的table(parent)連動 例如一起被刪除</p>
</blockquote>
<h2 id="Embedded"><a href="#Embedded" class="headerlink" title="Embedded"></a>Embedded</h2><blockquote>
<p>在table中坎入其他table或pojo class 避免宣告裡必須攤平所有欄位失去結構 可作為查詢時暫用的表</p>
</blockquote>
<blockquote>
<p>實際的解析上有點像是將Embedded表的欄位名(變數名)平面化 所以各個表中的欄位名還不能重複 若重複還要加prefix將整個表的欄位名加前綴</p>
</blockquote>
<blockquote>
<p>select語句針對prefix的部分必須一一列出(太麻煩了)</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *, tbl_b.id <span class="keyword">as</span> prefix_id <span class="keyword">FROM</span> tbl_a <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tbl_b <span class="keyword">ON</span> tbl_a.id=tbl_b.id <span class="keyword">WHERE</span> ...</span><br></pre></td></tr></table></figure>
<h2 id="Relation"><a href="#Relation" class="headerlink" title="Relation"></a>Relation</h2><blockquote>
<p>可以建立一個連動的查詢 整合到一個table中 (用起來方便但要多建一個class)</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">BookSet</span></span>(</span><br><span class="line">        <span class="meta">@Embedded</span></span><br><span class="line">        <span class="keyword">var</span> info: BookInfo?=<span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//BookContent.bookId對映BookInfo.id</span></span><br><span class="line"><span class="comment">//查詢的結果必須是List或Set</span></span><br><span class="line">        <span class="meta">@Relation(parentColumn = <span class="meta-string">"id"</span>,</span></span><br><span class="line"><span class="meta">                entityColumn = <span class="meta-string">"bookId"</span>)</span> <span class="keyword">var</span> content: List&lt;BookContent&gt;?=<span class="literal">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Migration-升級"><a href="#Migration-升級" class="headerlink" title="Migration 升級"></a>Migration 升級</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/DB-MySQL.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/DB-MySQL.html" itemprop="url">DB-MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:30:37+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLiteOpenHelper"><a href="#SQLiteOpenHelper" class="headerlink" title="SQLiteOpenHelper"></a>SQLiteOpenHelper</h2><p><a href="https://www.jianshu.com/p/8e3f294e2828" target="_blank" rel="noopener">ref</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DBHelper</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, <span class="string">"mydb.db"</span>, <span class="keyword">null</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        db.execSQL(<span class="string">"CREATE TABLE IF NOT EXISTS user(\</span></span><br><span class="line"><span class="string">            _id INTEGER PRIMARY KEY AUTOINCREMENT, \</span></span><br><span class="line"><span class="string">            name TEXT)"</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dbHelper = <span class="keyword">new</span> DatabaseHelper(context);</span><br><span class="line"></span><br><span class="line">SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">SQLiteDatabase db = dbHelper.getReadableDatabase();</span><br><span class="line">db.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">//insert</span></span><br><span class="line">ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line"></span><br><span class="line">values.put(<span class="string">"id"</span>, <span class="number">1</span>);</span><br><span class="line">values.put(<span class="string">"name"</span>, <span class="string">"jim"</span>);</span><br><span class="line">db.insert(<span class="string">"user"</span>, <span class="keyword">null</span>, values);</span><br><span class="line">db.execSQL(<span class="string">"insert into user (id,name) values (1,'carson')"</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">//update</span></span><br><span class="line">values.put(<span class="string">"name"</span>, <span class="string">"jim2"</span>);</span><br><span class="line">db.update(<span class="string">"user"</span>, values, <span class="string">"_id=?"</span>, <span class="keyword">new</span> String[] &#123; <span class="string">"1"</span> &#125;);</span><br><span class="line">db.execSQL(<span class="string">"update [user] set name = 'jim2' where _id=1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//delete</span></span><br><span class="line">db.delete(<span class="string">"user"</span>, <span class="string">"_id=?"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"1"</span>&#125;);</span><br><span class="line">db.execSQL(<span class="string">"delete from user where _id=1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//selete</span></span><br><span class="line">Cursor c = db.rawQuery(<span class="string">"select * from user where id=?"</span>,<span class="keyword">new</span> Stirng[]&#123;<span class="string">"1"</span>&#125;);</span><br><span class="line">c = db.rawQuery(<span class="string">"SELECT _id, name FROM user"</span>);</span><br><span class="line">c = db.query(<span class="string">"user"</span>, <span class="keyword">new</span> String[] &#123; <span class="string">"_id"</span>, <span class="string">"name"</span> &#125;, <span class="string">"_id=?"</span>, </span><br><span class="line">        <span class="keyword">new</span> String[] &#123; <span class="string">"1"</span> &#125;, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Cursor"><a href="#Cursor" class="headerlink" title="Cursor"></a>Cursor</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//遍歷1</span></span><br><span class="line"><span class="keyword">while</span> (c.moveToNext()) &#123;</span><br><span class="line">    <span class="keyword">int</span> idx = c.getColumnIndex(<span class="string">"_id"</span>); <span class="comment">//取得欄位idx</span></span><br><span class="line">    <span class="keyword">int</span> id = c.getInt(idx); <span class="comment">//取得資料</span></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//遍歷2</span></span><br><span class="line">c.moveToFirst();  </span><br><span class="line"><span class="keyword">while</span>(!c.isAfterLast())&#123;  </span><br><span class="line">    <span class="comment">//dosomething  </span></span><br><span class="line">    c.moveToNext();  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//記得關閉</span></span><br><span class="line">c.close();</span><br></pre></td></tr></table></figure>
<h4 id="將db檔預先置入apk"><a href="#將db檔預先置入apk" class="headerlink" title="將db檔預先置入apk"></a>將db檔預先置入apk</h4><blockquote>
<p>將寫好的db放到res/raw下 在開啟db前將資源寫入android檔案系統</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">InputStream myInput = context.getResources().openRawResource(R.raw.database);</span><br><span class="line"></span><br><span class="line">File file = context.getDatabasePath(<span class="string">"mydb.db"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      OutputStream myOutput = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">      <span class="keyword">int</span> length;</span><br><span class="line">      <span class="keyword">while</span> ((length = myInput.read(buffer))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">          myOutput.write(buffer, <span class="number">0</span>, length);</span><br><span class="line">      &#125;</span><br><span class="line">      myOutput.close();</span><br><span class="line">      myInput.close();</span><br><span class="line">      mIsDBOK = <span class="keyword">true</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/Task.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/Task.html" itemprop="url">Task</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:08:38+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Activity-runOnUiThread"><a href="#Activity-runOnUiThread" class="headerlink" title="Activity.runOnUiThread"></a>Activity.runOnUiThread</h2><blockquote>
<p>activity內建的一方法 便於異步切回main thread</p>
</blockquote>
<h2 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h2><p><a href="https://blog.csdn.net/carson_ho/article/details/79314325" target="_blank" rel="noopener">ref</a></p>
<blockquote>
<p>aad : Execute a background task inside of a Service</p>
</blockquote>
<ul>
<li>thread pool+handler應用的再封裝 易於與main(UI) thread切換</li>
<li>需在main thread建立與執行 (最終記得cancel)</li>
<li>如同Thread一次性使用 結束後無法重新啟動</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span> , <span class="title">Integer</span> , <span class="title">Bitmap</span>&gt;</span>&#123;</span><br><span class="line"><span class="comment">//&lt;傳入型態, 進度值型態, 結果型態&gt;</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">doInBackground</span><span class="params">(String ...args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//進入異步 不要做view操作</span></span><br><span class="line">        publishProgress(...);</span><br><span class="line">        </span><br><span class="line">        activity.runOnUiThread</span><br><span class="line">    &#125;</span><br><span class="line">    onPreExecute() <span class="comment">//回main thread</span></span><br><span class="line">    onProgressUpdate(Integer... values) <span class="comment">//回main thread</span></span><br><span class="line">    onPostExecute(Bitmap bitmap) <span class="comment">//回main thread</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> MyTask().execute(<span class="string">"str"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.設定好要count down的數量</span></span><br><span class="line"><span class="keyword">final</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.在異步thread結束後countDown使其歸零</span></span><br><span class="line">countDownLatch.countDown();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.一直等到countDownLatch為0才返回</span></span><br><span class="line">countDownLatch.await();</span><br></pre></td></tr></table></figure>
<h2 id="Timer-amp-TimerTask"><a href="#Timer-amp-TimerTask" class="headerlink" title="Timer &amp; TimerTask"></a>Timer &amp; TimerTask</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Timer timer = <span class="keyword">new</span> Timer()</span><br><span class="line">timer.schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>, <span class="number">1000</span>);</span><br><span class="line">timer.cancel()</span><br></pre></td></tr></table></figure>
<h2 id="Looper-Handler"><a href="#Looper-Handler" class="headerlink" title="Looper + Handler"></a>Looper + Handler</h2><blockquote>
<p>Looper消息接收器 建立時連帶建立一個MessageQueue</p>
</blockquote>
<blockquote>
<p>Handler消息處理/發送器</p>
</blockquote>
<blockquote>
<p>用途在於將msg或task隊列執行 </p>
</blockquote>
<blockquote>
<p>Looper與Handler內部都是利用current thread做為key 所以建立與呼叫時所處的thread很重要</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自訂的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LooperThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Handler mHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//以當下thread建立looper (內部會存於map中)</span></span><br><span class="line">        Looper.prepare();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//以當下thread建立Handler 並取得當下thread的looper中的MessageQueue</span></span><br><span class="line">        <span class="comment">//於是looper與handler都有共通的msgQueue</span></span><br><span class="line">        <span class="comment">//之後外部可用handler建立傳遞msg進入msgQueue</span></span><br><span class="line">        <span class="comment">//loop即能收到msg並透過msg的callback回叫handler</span></span><br><span class="line">        mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//以當下thread執行loop (當下thread會進入等待msg的loop而block住)</span></span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h4><blockquote>
<p>內部是透過native code實現主要機制</p>
</blockquote>
<h4 id="HandlerThread"><a href="#HandlerThread" class="headerlink" title="HandlerThread"></a>HandlerThread</h4><blockquote>
<p>同上方範例 但沒有handler</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download2</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    HandlerThread ht = <span class="keyword">new</span> HandlerThread(<span class="string">"MyHandlerThread"</span>);</span><br><span class="line">    ht.start();<span class="comment">//必須先啟動thread (執行prepare後looper才會建立)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接指定Handler的looper</span></span><br><span class="line">    Handler handler = <span class="keyword">new</span> Handler(ht.getLooper()) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//H:MyHandlerThread</span></span><br><span class="line">            System.out.println(<span class="string">"H:"</span>+Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">if</span> (msg.obj==<span class="string">"quit"</span>)</span><br><span class="line">               getLooper().quit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    handler.post(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="comment">//R:MyHandlerThread</span></span><br><span class="line">            System.out.println(<span class="string">"R:"</span>+Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    handler.obtainMessage(<span class="number">0</span>, <span class="string">"url"</span>).sendToTarget();</span><br><span class="line">    handler.obtainMessage(<span class="number">0</span>, <span class="string">"quit"</span>).sendToTarget();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>main thread預設已執行prepare 所以在main thread下Handler能直接使用</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/MonkeyTest.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/MonkeyTest.html" itemprop="url">壓力循環測試</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:06:51+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.youtube.com/playlist?list=PLO5e_-yXpYLD_0y8agkLMcYwqegmXFNMD" target="_blank" rel="noopener">Android測試</a></p>
<h2 id="adb-android-debug-bridge"><a href="#adb-android-debug-bridge" class="headerlink" title="adb (android debug bridge)"></a>adb (android debug bridge)</h2><p>Android SDK本地端執行程式</p>
<p>crash / anr(activity not responding)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">//列出device</span><br><span class="line">adb devices</span><br><span class="line"></span><br><span class="line">//進入手機shell (如果Permission denied可執行su)</span><br><span class="line">adb shell</span><br><span class="line"></span><br><span class="line">//到安裝路徑</span><br><span class="line"><span class="built_in">cd</span> /data/data/com.jimliuxyz.vocabook.mock/</span><br><span class="line"></span><br><span class="line">//安裝apk</span><br><span class="line">adb install package.apk</span><br><span class="line"></span><br><span class="line">//取得 device <span class="built_in">log</span></span><br><span class="line">adb logcat</span><br></pre></td></tr></table></figure>
<h2 id="monkey"><a href="#monkey" class="headerlink" title="monkey"></a>monkey</h2><p>Android OS上的測試程式</p>
<h2 id="monkey-自動壓力測試-隨機操作"><a href="#monkey-自動壓力測試-隨機操作" class="headerlink" title="monkey 自動壓力測試(隨機操作)"></a>monkey 自動壓力測試(隨機操作)</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">//執行測試 (隨機點擊操作)</span><br><span class="line">adb shell monkey 100</span><br><span class="line"></span><br><span class="line">//執行100個操作 每1000ms執行一次 以50為操作seed</span><br><span class="line">adb shell monkey -p tw.com.langstar.t1 -v -s 50 --throttle 1000 100</span><br><span class="line"></span><br><span class="line">-v : detial info</span><br><span class="line">-s : seed操作種子 固定的種子能複製出同樣的操作行為</span><br><span class="line">--pct-touch : touch操作的百分比</span><br><span class="line">--ignore-crashes : crash後自動重啟再測試</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">//手機內存放anr的<span class="built_in">log</span>目錄</span><br><span class="line">data/anr</span><br></pre></td></tr></table></figure>
<h2 id="monkey-自訂測試腳本"><a href="#monkey-自訂測試腳本" class="headerlink" title="monkey 自訂測試腳本"></a>monkey 自訂測試腳本</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">//Android SDK內建的UI元件檢視器 能查詢執行中的app</span><br><span class="line">/Users/jimliu/Library/Android/sdk/tools/bin/uiautomatorviewer</span><br><span class="line"></span><br><span class="line">//上傳檔案</span><br><span class="line">adb push myscript /data/<span class="built_in">local</span>/tmp</span><br><span class="line"></span><br><span class="line">//執行測試 (隨機點擊操作)</span><br><span class="line">adb shell monkey -f /data/<span class="built_in">local</span>/tmp/myscript 100</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">// 點擊</span><br><span class="line">DispatchPointer(downtime,eventide,press:0/release:1,x,y,pressure,size,metastate,xpresision,ypresision,device,edgeflags)DispatchPointer(10,10,0,100,100,1,1,-1,1,1,0,0)</span><br><span class="line"></span><br><span class="line">DispatchString(mystr)</span><br><span class="line"></span><br><span class="line">//manifest的activity須加exported=<span class="string">"true"</span>屬性</span><br><span class="line">LaunchActivity(package, package + ActivityName)</span><br><span class="line"></span><br><span class="line">UserWait(1000) //ms</span><br><span class="line"></span><br><span class="line">DispatchPress(66) //keycode</span><br></pre></td></tr></table></figure>
<h2 id="monkeyrunner"><a href="#monkeyrunner" class="headerlink" title="monkeyrunner"></a>monkeyrunner</h2><p>Android SDK本地端程式<br>/Users/jimliu/Library/Android/sdk/tools/bin/monkeyrunner<br>從本地端執行python控制測試流程 可抓圖</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> com.android.monkeyrunner <span class="keyword">import</span> MonkeyRunner,MonkeyDevice,MonkeyImage</span><br><span class="line"><span class="comment">#MonkeyRunner.alert("msg", "title", "okText")</span></span><br><span class="line"></span><br><span class="line">device = MonkeyRunner.waitForConnection(<span class="number">3</span>, <span class="string">"emulator-5554"</span>)</span><br><span class="line"></span><br><span class="line">device.startActivity(<span class="string">"package/package.activityname"</span>)</span><br><span class="line"></span><br><span class="line">MonkeyRunner.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">device.touch(<span class="number">100</span>, <span class="number">100</span>, <span class="string">"DOWN_AND_UP"</span>)</span><br><span class="line"></span><br><span class="line">device.type(<span class="string">"string"</span>)</span><br><span class="line">device.press(<span class="string">"KEYCODE_ENTER"</span>, <span class="string">"DOWN_AND_UP"</span>)</span><br><span class="line"></span><br><span class="line">image = device.takeSnapshot()</span><br><span class="line">image.writeToFile(<span class="string">"./test.png"</span>, <span class="string">"png"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">monkeyrunner demo.py</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Linux/Single/ShellCmd.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Linux/Single/ShellCmd.html" itemprop="url">ShellCmd</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:04:44+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.openfoundry.org/foss-programs/8628" target="_blank" rel="noopener">ref</a><br><a href="http://rodney2009.pixnet.net/blog/post/21465471-%E5%B7%A5%E4%BD%9C%E5%B8%B8%E7%94%A8%E5%88%B0%E7%9A%84linux%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">ref</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 搜尋執行檔路徑 (依環境path)</span></span><br><span class="line"><span class="built_in">which</span> git</span><br><span class="line">whereis git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依檔名尋找檔案</span></span><br><span class="line">find / -name git</span><br><span class="line"></span><br><span class="line">find grep awk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 資料夾中搜尋文件內容</span></span><br><span class="line">grep -r <span class="string">'導航'</span> ~/GoogleDrive/</span><br><span class="line"></span><br><span class="line">grep -r --include=<span class="string">"*.java"</span> <span class="string">"service"</span> .</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/Nav.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/Nav.html" itemprop="url">頁面導航</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T16:01:31+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="task-back-stack行為設定參考"><a href="#task-back-stack行為設定參考" class="headerlink" title="task back stack行為設定參考"></a>task back stack行為設定參考</h2><p><a href="https://developer.android.com/guide/components/tasks-and-back-stack.html?hl=zh-tw" target="_blank" rel="noopener">官方中文說明</a><br><a href="https://www.youtube.com/playlist?list=PLO5e_-yXpYLCQNdl6G8RIZLrlBPRQDCWR" target="_blank" rel="noopener">Android 深入Activity</a><br><a href="https://www.bilibili.com/video/av11208065/index_11.html#page=1" target="_blank" rel="noopener">Android基礎知識</a></p>
<ol>
<li>launchMode</li>
<li>intent flag</li>
<li>minifest activity</li>
</ol>
<h2 id="Deep-Link-App-Links-超連結啟動app"><a href="#Deep-Link-App-Links-超連結啟動app" class="headerlink" title="Deep Link(App Links) 超連結啟動app"></a>Deep Link(App Links) 超連結啟動app</h2><p><a href="https://developer.android.com/training/app-links/deep-linking.html" target="_blank" rel="noopener">ref</a><br><a href="https://developer.android.com/studio/write/app-link-indexing.html" target="_blank" rel="noopener">ref</a></p>
<blockquote>
<p>aad:Implement non-standard task stack navigation (deep links)</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span> <span class="comment">&lt;!--從adb啟動--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span> /&gt;</span> <span class="comment">&lt;!--從browser啟動--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"app"</span> <span class="attr">android:host</span>=<span class="string">"jimliuxyz.com"</span>&gt;</span><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell am start -W -a android.intent.action.VIEW -d <span class="string">"app://jimliuxyz.com"</span> com.jimliuxyz.tsnote</span><br><span class="line"></span><br><span class="line">am : activity maneger</span><br><span class="line">-W : <span class="built_in">wait</span> <span class="keyword">for</span> launch to complete</span><br><span class="line">[-a &lt;ACTION&gt;] [-d &lt;DATA_URI&gt;]</span><br><span class="line">package不一定要</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要用override fun onNewIntent()處理 activity要為<code>singleTop</code>之類</p>
</blockquote>
<h2 id="TaskStackBuilder"><a href="#TaskStackBuilder" class="headerlink" title="TaskStackBuilder"></a>TaskStackBuilder</h2><p><a href="https://www.youtube.com/watch?v=MvIlVsXxXmY" target="_blank" rel="noopener">ref</a><br><a href="https://developer.android.com/training/implementing-navigation/ancestral.html" target="_blank" rel="noopener">ref</a></p>
<blockquote>
<p>用於憑空建立parent activity於TaskStack中<br>當MsgActivity是從其他app(intent或deep link)啟動時 並沒有自己的back stack 所以按下back按鈕時 無法回到MainActivity 此時就需要NavUtils工具</p>
</blockquote>
<h4 id="Minifest"><a href="#Minifest" class="headerlink" title="Minifest"></a>Minifest</h4><blockquote>
<p>指定android:parentActivityName為欲返回的MainActivity</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.example.myfirstapp.MsgActivity"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">"display_message"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:parentActivityName</span>=<span class="string">"com.example.myfirstapp.MainActivity"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Parent activity meta-data to support 4.0 and lower --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"android.support.PARENT_ACTIVITY"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">"com.example.myfirstapp.MainActivity"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通常都經由ActionBar左上角的箭頭驅動返回事件(android.R.id.home)</span></span><br><span class="line">getActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//測試不ok</span></span><br><span class="line">Intent upIntent = NavUtils.getParentActivityIntent(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">if</span> (NavUtils.shouldUpRecreateTask(<span class="keyword">this</span>, upIntent)) &#123;</span><br><span class="line">    <span class="comment">//非處於自己app的back stack中時</span></span><br><span class="line">    TaskStackBuilder.create(<span class="keyword">this</span>)</span><br><span class="line">        .addNextIntentWithParentStack(upIntent)</span><br><span class="line">        .startActivities();</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">    NavUtils.navigateUpTo(<span class="keyword">this</span>, upIntent);</span><br></pre></td></tr></table></figure>
<h4 id="透過PendingIntent預先設定好-測試ok"><a href="#透過PendingIntent預先設定好-測試ok" class="headerlink" title="透過PendingIntent預先設定好(測試ok)"></a>透過PendingIntent預先設定好(測試ok)</h4><p><a href="https://developer.android.com/training/notify-user/navigation.html" target="_blank" rel="noopener">notify-user</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MsgActivity.class);</span><br><span class="line"></span><br><span class="line">TaskStackBuilder stackBuilder = TaskStackBuilder.create(<span class="keyword">this</span>);</span><br><span class="line">stackBuilder.addNextIntentWithParentStack(intent); <span class="comment">//依manifest設定的android:parentActivityName</span></span><br><span class="line"></span><br><span class="line">pi = stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br></pre></td></tr></table></figure>
<h2 id="launchMode"><a href="#launchMode" class="headerlink" title="launchMode"></a>launchMode</h2><blockquote>
<p>manifest可設定activity的android:launchMode</p>
</blockquote>
<h4 id="standard-不斷新建堆疊"><a href="#standard-不斷新建堆疊" class="headerlink" title="standard : 不斷新建堆疊"></a>standard : 不斷新建堆疊</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a - a&apos; - a&apos;&apos;</span><br></pre></td></tr></table></figure>
<h4 id="singleTop-同standard-但當該activity已處於stack-top時不會再新建"><a href="#singleTop-同standard-但當該activity已處於stack-top時不會再新建" class="headerlink" title="singleTop : 同standard,但當該activity已處於stack top時不會再新建"></a>singleTop : 同standard,但當該activity已處於stack top時不會再新建</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a - a - a - b - a&apos; - a&apos;</span><br></pre></td></tr></table></figure>
<h4 id="singleTask-不會重開-該activity出現時勢必將task中其他task全部拋掉"><a href="#singleTask-不會重開-該activity出現時勢必將task中其他task全部拋掉" class="headerlink" title="singleTask : 不會重開,該activity出現時勢必將task中其他task全部拋掉"></a>singleTask : 不會重開,該activity出現時勢必將task中其他task全部拋掉</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a - a - b - c - d - a [back]離開app</span><br></pre></td></tr></table></figure>
<h4 id="singleInstance-不會新建-該activity的task僅允許自己使用"><a href="#singleInstance-不會新建-該activity的task僅允許自己使用" class="headerlink" title="singleInstance : 不會新建,該activity的task僅允許自己使用"></a>singleInstance : 不會新建,該activity的task僅允許自己使用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a - a -     a [back]離開a回到b</span><br><span class="line">        b -                  [back]離開b回到home</span><br></pre></td></tr></table></figure>
<h2 id="簡述"><a href="#簡述" class="headerlink" title="簡述"></a>簡述</h2><ul>
<li>standard - 不斷重開堆疊 : 預設 (可能有多個aty重複)</li>
<li>singleTop - 頂端不新建 : 合理避免重複 (可能有多個aty重複)</li>
<li>singleTask - 頂端排他 task pop all : Home</li>
<li>singleInstance - 獨佔 : 供別的app使用</li>
</ul>
<p>single指的是activity不新建 但會執行onNewIntent()</p>
<h2 id="taskAffinity-allowTaskReparenting"><a href="#taskAffinity-allowTaskReparenting" class="headerlink" title="taskAffinity allowTaskReparenting"></a>taskAffinity allowTaskReparenting</h2><p>affinity類似一個groupId的概念 activity預設的affinity為package name<br>當一個activity以FLAG_ACTIVITY_NEW_TASK啟動時會以affinity去找該被加到哪個task中</p>
<h2 id="FLAG-ACTIVITY"><a href="#FLAG-ACTIVITY" class="headerlink" title="FLAG_ACTIVITY"></a>FLAG_ACTIVITY</h2><p>透過intent開啟的activity該依循何策略進入task或操作stack</p>
<ul>
<li>FLAG_ACTIVITY_NEW_TASK(同singleTask) : aty會在自己的task中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new aty : 為aty新增task</span><br><span class="line">new aty : push進aty原屬的task</span><br><span class="line">old aty : 顯示task但aty不會到top (怪怪的)</span><br></pre></td></tr></table></figure>
<ul>
<li>FLAG_ACTIVITY_CLEAR_TOP : pop出原本在其上者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b是FLAG_ACTIVITY_CLEAR_TOP</span><br><span class="line">a - b - c - d - b (此時cd會被pop出,剩下ab)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>FLAG_ACTIVITY_BROUGHT_TO_FRONT : activity會to front</p>
</li>
<li><p>FLAG_ACTIVITY_MULTIPLE_TASK : 能以另一個task啟動(act實體個別存在不同的task)</p>
</li>
<li><p>FLAG_ACTIVITY_SINGLE_TOP(同singleTop)</p>
</li>
<li><p>FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET與FLAG_ACTIVITY_RESET_TASK_IF_NEEDED : 1.設定清除點 2.pop掉清除點與之後的</p>
</li>
</ul>
<p>還有很多…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/Intent.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/Intent.html" itemprop="url">Intent</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T15:59:41+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>一個意圖/命令的容器<br>putExtra僅能傳遞native type,或序列化物件(Serializable或Parcelable)</p>
</blockquote>
<ul>
<li>顯示 : 指定元件的類別</li>
<li>隱式 : 僅提供ACTION/CATEGORY/URI 不指定元件的類別</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">intent.setDataAndType(Uri.fromFile(file), <span class="string">"image/*"</span>);</span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line">intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, Uri.parse(<span class="string">"http://..."</span>));</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<h2 id="Intent導航與返航"><a href="#Intent導航與返航" class="headerlink" title="Intent導航與返航"></a>Intent導航與返航</h2><p>####導航</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//啟動</span></span><br><span class="line">startActivity(intent)</span><br><span class="line">startActivityForResult(intent, req_id) <span class="comment">//透過activity或fragment呼叫</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//被啟動</span></span><br><span class="line"><span class="function">override fun <span class="title">onCreate</span><span class="params">(savedInstanceState: Bundle?)</span>  <span class="comment">//首次啟動</span></span></span><br><span class="line"><span class="function">override fun <span class="title">onNewIntent</span><span class="params">(intent: Intent?)</span>   <span class="comment">//已啟動 但有新intent</span></span></span><br></pre></td></tr></table></figure>
<p>####返航</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">setResult() <span class="comment">//均透過activity</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(int requestCode, int resultCode, Intent <span class="keyword">data</span>)</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>fragment有startActivityForResult與onActivityResult,但沒有setResult</p>
</blockquote>
<h4 id="PendingIntent"><a href="#PendingIntent" class="headerlink" title="PendingIntent"></a>PendingIntent</h4><blockquote>
<p>封裝執行intent的機制 類似於將startActive/startService與intent封裝起來 丟給系統 透過系統機制讓user觸發intent此外尚有些flag策略 通常就是和Notification合用</p>
</blockquote>
<h4 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h4><blockquote>
<p>位於手機上方的通知欄 可作為service的ui使其能顯示狀態與被使用者操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//NotificationManager</span></span><br><span class="line">nm = (NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Intent</span></span><br><span class="line">intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK);</span><br><span class="line"></span><br><span class="line"><span class="comment">//PendingIntent</span></span><br><span class="line">pi = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, PendingIntent.FLAG_ONE_SHOT);</span><br><span class="line"></span><br><span class="line"><span class="comment">//NotificationCompat.Builder</span></span><br><span class="line">builder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">"practice_channel"</span>)</span><br><span class="line">        .setSmallIcon(android.R.drawable.ic_dialog_info)</span><br><span class="line">        .setContentTitle(getString(R.string.time_to_practice))</span><br><span class="line">        .setContentText(getString(R.string.it_is_time_to_practice))</span><br><span class="line">        .setAutoCancel(<span class="keyword">true</span>)</span><br><span class="line">        .setContentIntent(pi);</span><br><span class="line"></span><br><span class="line"><span class="comment">//產生與取消</span></span><br><span class="line">nm.notify(NOTIFICATION_ID, builder.build());</span><br><span class="line"></span><br><span class="line">nm.cancel(NOTIFICATION_ID);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/CheatSheet.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/CheatSheet.html" itemprop="url">Android CheatSheet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T15:58:09+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//下載圖片</span></span><br><span class="line">img = Drawable.createFromStream(<span class="keyword">new</span> URL(url).openStream(), <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//顯示短暫訊息</span></span><br><span class="line">Toast.makeText(<span class="keyword">this</span>, <span class="string">"..."</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">getResources().getStringArray(R....);</span><br><span class="line">getResources().getXml(R....); <span class="comment">//XmlResourcesParser</span></span><br><span class="line">getAssets().open(<span class="string">"..."</span>)</span><br><span class="line">getSystemService(Service...)</span><br><span class="line"></span><br><span class="line"><span class="comment">//URI</span></span><br><span class="line">MediaStore.Images.Media.INTERNAL_CONTENT_URI</span><br></pre></td></tr></table></figure>
<h2 id="查看activity-back-stack"><a href="#查看activity-back-stack" class="headerlink" title="查看activity back stack"></a>查看activity back stack</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys activity activities | sed -En -e <span class="string">'/Running activities/,/Run #0/p'</span> | sed -En -e <span class="string">'/com.jimliuxyz/p'</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/HelpingTools.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/HelpingTools.html" itemprop="url">協助工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T15:55:53+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="uiautomatorviewer"><a href="#uiautomatorviewer" class="headerlink" title="uiautomatorviewer"></a>uiautomatorviewer</h2><blockquote>
<p>檢視View階層 (方面找ID)</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Library/Android/sdk/tools/bin/ uiautomatorviewer</span><br></pre></td></tr></table></figure>
<h2 id="draw9patch"><a href="#draw9patch" class="headerlink" title="draw9patch"></a>draw9patch</h2><blockquote>
<p>製作不受縮放影響畫質的按鈕外框圖樣 (避免四角被伸縮)</p>
</blockquote>
<h2 id="查詢TaskStack"><a href="#查詢TaskStack" class="headerlink" title="查詢TaskStack"></a>查詢TaskStack</h2><p><a href="https://www.jianshu.com/p/d859480613a4" target="_blank" rel="noopener">adb shell dumpsys</a><br><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys</span><br></pre></td></tr></table></figure></p>
<h2 id="Android-Debug-Database"><a href="#Android-Debug-Database" class="headerlink" title="Android-Debug-Database"></a>Android-Debug-Database</h2><p><a href="https://github.com/amitshekhariitbhu/Android-Debug-Database" target="_blank" rel="noopener">ref</a>, <a href="http://localhost:8080/#" target="_blank" rel="noopener">本地端連結</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    debugImplementation 'com.amitshekhar.android:debug-db:1.0.0'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Working with emulator</span></span><br><span class="line"><span class="built_in">cd</span> /Users/jimliu/Library/Android/sdk/platform-tools</span><br><span class="line">./adb forward tcp:8080 tcp:8080</span><br></pre></td></tr></table></figure>
<h2 id="LeakCanary"><a href="#LeakCanary" class="headerlink" title="LeakCanary"></a>LeakCanary</h2><p><a href="https://github.com/jimliuxyz/leakcanary" target="_blank" rel="noopener">LeakCanary</a></p>
<blockquote>
<p>檢測記憶體洩漏 (針對activity生命週期)</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  debugImplementation 'com.squareup.leakcanary:leakcanary-android:1.5.4'</span><br><span class="line">  releaseImplementation 'com.squareup.leakcanary:leakcanary-android-no-op:1.5.4'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    <span class="keyword">if</span> (LeakCanary.isInAnalyzerProcess(<span class="keyword">this</span>))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    LeakCanary.install(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/home/Android/Testing.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimLiuXyz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自用筆記">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/home/Android/Testing.html" itemprop="url">功能測試</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-04-04T15:51:42+08:00">
                2018-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="JUnit"><a href="#JUnit" class="headerlink" title="JUnit"></a>JUnit</h2><blockquote>
<p>僅於本地JVM上測試 又稱單元測試(函數功能測試) 不依靠android環境</p>
</blockquote>
<blockquote>
<p>以滑鼠右鍵選單”Go To&gt;Test”快速建立test class</p>
</blockquote>
<h4 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h4><ul>
<li>@Test 註解一函數為 測試使用</li>
<li>@Test(expected = Exception.class) 使符合預期時拋出異常</li>
<li>@Test(timeout=100) 指定測試需在100ms內完成</li>
<li>@Before 註解一函數為 每個測試函數執行要先執行的函數</li>
<li>@After 邏輯同上</li>
<li>@BeforeClass @AfterClass 邏輯同上 但僅為整個class執行一次</li>
<li>@Mock 宣告一個<code>假物件</code></li>
<li>@Captor 宣告一個<code>叫用參數捕捉器</code>(以取得叫用參數)</li>
<li>@Spy 監視一個真物件</li>
<li>@Rule 修飾TestRule</li>
</ul>
<h4 id="Matchers"><a href="#Matchers" class="headerlink" title="Matchers"></a>Matchers</h4><blockquote>
<p>比對器 類似過濾行為 能以廣義的形容區別物件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">eq</span><br><span class="line">is 是某個object</span><br><span class="line">isA 是某個class</span><br><span class="line">not</span><br><span class="line">anyInt</span><br><span class="line">hasItem</span><br></pre></td></tr></table></figure>
<h4 id="Assert"><a href="#Assert" class="headerlink" title="Assert"></a>Assert</h4><blockquote>
<p>斷言結果 <code>判斷值是否符合預期</code> 若不符合斷言即為測試失敗</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//斷言結果需為true</span></span><br><span class="line">assertTrue(<span class="string">"test failure"</span>, mockins.func() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//斷言instance.func()執行回傳為1</span></span><br><span class="line">assertThat(<span class="string">"test failure"</span>, mockins.func(), is(<span class="number">1</span>)); <span class="comment">//用Matcher判斷</span></span><br><span class="line">assertThat(mockins.getList(), not(hasItem(not_expected));</span><br><span class="line"></span><br><span class="line"><span class="comment">//assertEquals</span></span><br></pre></td></tr></table></figure>
<h4 id="mockito-製作假物件"><a href="#mockito-製作假物件" class="headerlink" title="mockito 製作假物件"></a>mockito 製作假物件</h4><p><a href="https://blog.csdn.net/shensky711/article/details/52771493" target="_blank" rel="noopener">ref</a></p>
<blockquote>
<p>通過製作假物件與指定其反應回傳 來驗證該假物件<code>是否被呼叫?以何參數呼叫?</code></p>
</blockquote>
<blockquote>
<p>通常被測物需為真物件(因為要測試他的邏輯) 其依賴物為假物件(不著重邏輯是否正確或回傳什麼 僅著重是否被真物件正確叫用)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 產生mock物件</span></span><br><span class="line"><span class="meta">@Mock</span> MyClass mockIns; <span class="comment">//不需要new</span></span><br><span class="line">MockitoAnnotations.initMocks(<span class="keyword">this</span>); <span class="comment">//但之後要做init使class內的@Mock生效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. 產生mock物件</span></span><br><span class="line">LinkedList mockList = mock(LinkedList.class);</span><br><span class="line">LinkedList mockList = mock(LinkedList.class, Mockito.RETURNS_SMART_NULLS); <span class="comment">//指定預設的回傳</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 指定mock物件的反應 (此動作稱為Stubbing)</span></span><br><span class="line">when(mockList.get(<span class="number">0</span>)).thenReturn(<span class="string">"it's a mock string"</span>);</span><br><span class="line">when(mockList.get(<span class="number">1</span>)).thenThrow(<span class="keyword">new</span> RuntimeException());</span><br><span class="line">when(mockList.get(anyInt())).thenReturn(<span class="string">"element"</span>);</span><br><span class="line">when(mockList.size()).thenReturn(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">//每次回傳都不同</span></span><br><span class="line"><span class="comment">//doReturn, doThrow, doAnswer, doNothing, doCallRealMethod</span></span><br><span class="line">doThrow(<span class="keyword">new</span> RuntimeException()).when(mockList).clear();</span><br><span class="line">reset(mockList); <span class="comment">//清除所有Stubbing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 經過某些動作操作後...即可進入驗證</span></span><br><span class="line">mockedList.add(<span class="string">"once"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//驗證1. 驗證mock物件的方法是否被呼叫(times, atLeast, atMost, atLeastOnce, never, timeout)</span></span><br><span class="line">verify(mockedList).add(<span class="string">"once"</span>);   </span><br><span class="line">verify(mockedList, times(<span class="number">1</span>)).add(<span class="string">"once"</span>); </span><br><span class="line">verify(mockedList).set(anyInt(), eq(<span class="string">"element"</span>)); <span class="comment">//用Matchers便於廣義的驗證</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//驗證2. 連帶驗證呼叫順序</span></span><br><span class="line">InOrder inOrder = inOrder(mockedList);</span><br><span class="line">inOrder.verify(mockedList).add(<span class="string">"first"</span>);</span><br><span class="line">inOrder.verify(mockedList).add(<span class="string">"second"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//驗證3. 捕捉呼叫參數</span></span><br><span class="line">ArgumentCaptor&lt;String&gt; args = ArgumentCaptor.forClass(String.class);</span><br><span class="line">mockedList.add(<span class="string">"John"</span>);</span><br><span class="line">verify(mockedList).add(args.capture()); <span class="comment">//驗證add的叫用 同時捕捉叫用的參數</span></span><br><span class="line">assertEquals(<span class="string">"John"</span>, args.getValue());</span><br></pre></td></tr></table></figure>
<h4 id="spy監視真物件"><a href="#spy監視真物件" class="headerlink" title="spy監視真物件"></a>spy監視真物件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List list = <span class="keyword">new</span> LinkedList();</span><br><span class="line">List spy = spy(list);</span><br><span class="line"><span class="comment">//之後spy即類似mockito的操作</span></span><br></pre></td></tr></table></figure>
<h4 id="TestRule"><a href="#TestRule" class="headerlink" title="TestRule"></a>TestRule</h4><blockquote>
<p>能在測試函數前後插入動作 例如偵測測試函數的執行時間</p>
</blockquote>
<blockquote>
<p>加入TestRule時需用@Rule註解才能與JUnit掛鉤</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRule</span> <span class="keyword">implements</span> <span class="title">TestRule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Statement <span class="title">apply</span><span class="params">(<span class="keyword">final</span> Statement base, <span class="keyword">final</span> Description description)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//base : 一個能夠驅使測試函數被執行的物件</span></span><br><span class="line">        <span class="comment">//description : 一個相關於測試函數環境的描述</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Statement() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evaluate</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//即測試前</span></span><br><span class="line">                base.evaluate();</span><br><span class="line">                <span class="comment">//即測試後</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Rule</span></span><br><span class="line">MyRule rule = <span class="keyword">new</span> MyRule()</span><br></pre></td></tr></table></figure>
<h2 id="Espresso"><a href="#Espresso" class="headerlink" title="Espresso"></a>Espresso</h2><p><a href="https://github.com/googlesamples/android-testing" target="_blank" rel="noopener">Android testing samples</a></p>
<blockquote>
<p>依賴於JUnit的一個測試框架</p>
</blockquote>
<blockquote>
<p>UI測試 依靠android環境執行 針對view元件進行驗證</p>
</blockquote>
<h4 id="基本三步驟"><a href="#基本三步驟" class="headerlink" title="基本三步驟"></a>基本三步驟</h4><ul>
<li>取得view或data的互動 onView / onData</li>
<li>執行動作 perform</li>
<li>檢查驗證 check</li>
</ul>
<h4 id="大致動作"><a href="#大致動作" class="headerlink" title="大致動作"></a>大致動作</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//操作view</span></span><br><span class="line">onView(withId(R.id.fab_add_task)).perform(click());</span><br><span class="line"><span class="comment">//檢查view</span></span><br><span class="line">onView(withId(R.id.add_task_title)).check(matches(isDisplayed()));</span><br></pre></td></tr></table></figure>
<h4 id="onView"><a href="#onView" class="headerlink" title="onView"></a>onView</h4><blockquote>
<p>ViewInteraction onView(Matcher<view> viewMatcher)</view></p>
</blockquote>
<blockquote>
<p>透過matcher取得view的控制</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Matcher&lt;View&gt;</span></span><br><span class="line">allOf 合併多個matcher</span><br><span class="line">withId</span><br><span class="line">withText</span><br><span class="line">isDisplayed</span><br><span class="line"></span><br><span class="line"><span class="comment">//其父view的id為R.id.recyclerView</span></span><br><span class="line">isDescendantOfA(withId(R.id.recyclerView))</span><br><span class="line"></span><br><span class="line"><span class="comment">//其父view為ListView.class</span></span><br><span class="line">isDescendantOfA(isAssignableFrom(ListView.class))</span><br><span class="line"></span><br><span class="line">hasDescendant</span><br><span class="line">hasSibling</span><br></pre></td></tr></table></figure>
<h4 id="perform"><a href="#perform" class="headerlink" title="perform"></a>perform</h4><blockquote>
<p>ViewInteraction perform(final ViewAction… viewActions)</p>
</blockquote>
<blockquote>
<p>執行動作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ViewAction</span></span><br><span class="line">click()</span><br><span class="line">LongClick()</span><br><span class="line">clearText()</span><br><span class="line">replaceText(<span class="string">""</span>)</span><br><span class="line">typeText(<span class="string">""</span>)</span><br><span class="line">closeSoftKeyboard()</span><br><span class="line"></span><br><span class="line"><span class="comment">//專為RecyclerView設計(actionOnItem)</span></span><br><span class="line">onView(allOf(withId(R.id.recyclerView)))</span><br><span class="line">    .perform(actionOnItem(hasDescendant(withText(<span class="string">"title"</span>)), click()));</span><br></pre></td></tr></table></figure>
<h4 id="check"><a href="#check" class="headerlink" title="check"></a>check</h4><blockquote>
<p>ViewInteraction check(final ViewAssertion viewAssert)</p>
</blockquote>
<blockquote>
<p>斷言</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ViewAssertion</span></span><br><span class="line">matches(isDisplayed()) <span class="comment">//使用view matcher來斷言</span></span><br><span class="line">doesNotExist()</span><br><span class="line">isChecked()</span><br></pre></td></tr></table></figure>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pressBack() <span class="comment">//按下返回鍵</span></span><br><span class="line">TestUtils.rotateXXX() <span class="comment">//控制手機旋轉</span></span><br><span class="line">TestUtils.getCurrentActivity()</span><br></pre></td></tr></table></figure>
<h4 id="TestUtils"><a href="#TestUtils" class="headerlink" title="TestUtils"></a>TestUtils</h4><blockquote>
<p>一個工具類 提供靜態方法控制手機裝置 rotate / getCurrentActivity</p>
</blockquote>
<h4 id="自訂Matcher"><a href="#自訂Matcher" class="headerlink" title="自訂Matcher"></a>自訂Matcher</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//一個回傳Matcher的function</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Matcher&lt;View&gt; <span class="title">withItemText</span><span class="params">(<span class="keyword">final</span> String itemText)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TypeSafeMatcher&lt;View&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matchesSafely</span><span class="params">(View item)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> allOf(</span><br><span class="line">                    <span class="comment">//其父view為ListView.class</span></span><br><span class="line">                    isDescendantOfA(isAssignableFrom(ListView.class)),</span><br><span class="line">                    <span class="comment">//且text為itemText</span></span><br><span class="line">                    withText(itemText)</span><br><span class="line">                ).matches(item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">describeTo</span><span class="params">(Description description)</span> </span>&#123;</span><br><span class="line">            description.appendText(<span class="string">"is isDescendantOfA LV with text "</span> + itemText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">JimLiuXyz</p>
              <p class="site-description motion-element" itemprop="description">自用筆記</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">121</span>
                  <span class="site-state-item-name">文章</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分類</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">標籤</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hexo.io/zh-tw/docs/" title="Hexo" target="_blank">Hexo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://theme-next.iissnan.com/" title="NextT" target="_blank">NextT</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JimLiuXyz</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
